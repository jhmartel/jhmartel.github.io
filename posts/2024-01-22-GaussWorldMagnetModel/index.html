<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="JHM">
<meta name="dcterms.date" content="2024-01-22">
<meta name="description" content="World Magnetic Model 2025. We begin with surprising review of Gauss’ 1836 memoir on General Theory of Terrestrial Magnetism which is amazing for it’s references to Amperes molecular current hypothesis and the aurora. Conclusion is that Gauss is correct assuming his classical magnetic fluid hypothesis, but Ampere’s electrodynamic cylinder and Poisson’s magnetic dipole surfaces are not complete. We identify our starting point for an Amperian Birkeland update to the standard Gauss spherical harmonic model, and this is subject of further work.">

<title>jhm - 2025 Year of World Magnetic Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../im1.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">jhm</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jhmartel/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/_jhmlabs" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">2025 Year of World Magnetic Model</h1>
                  <div>
        <div class="description">
          World Magnetic Model 2025. We begin with surprising review of Gauss’ 1836 memoir on General Theory of Terrestrial Magnetism which is amazing for it’s references to Amperes molecular current hypothesis and the aurora. Conclusion is that Gauss is correct assuming his classical magnetic fluid hypothesis, but Ampere’s electrodynamic cylinder and Poisson’s magnetic dipole surfaces are not complete. We identify our starting point for an Amperian Birkeland update to the standard Gauss spherical harmonic model, and this is subject of further work.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">ampere</div>
                <div class="quarto-category">gauss</div>
                <div class="quarto-category">magnetism</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>JHM </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 22, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction-to-world-magnet-model-wmm" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-world-magnet-model-wmm">Introduction to World Magnet Model (WMM)</h2>
<p>We have recently been made aware that 2025 is the year of the world magnetic model (WMM). As we have <a href="https://jhmartel.github.io/posts/2024-01-10-AmpereMagnetism/">discussed earlier</a>, magnetism underlies almost all fundamental experiments. Moreover the year 2025 will also introduce the <a href="https://www.asc-csa.gc.ca/eng/missions/artemis-ii/">Artemis II, III lunar space missions</a>. Eyes on the skies. So there is opportunity to engage with the WMM problem now. It’s becoming understood that magnetic fields at the poles are dangerously misunderstood.</p>
<p>The recent translation <span class="citation" data-cites="ampere">(<a href="#ref-ampere" role="doc-biblioref">Assis and Chaib 2015</a>)</span> has been crucial in our understanding of Ampere’s masterpiece and his interactions with the leading scientists of his time. Ampere had no formal education, yet became a professor of mathematics at l’Ecole Polytechnique in Lyons and then Paris. We are specifically interested in Ampere’s hypothesis of electrical molecular currents. A revealing comment included in a footnote quoting from William’s 1981 brief biography on Andre-Marie Ampere:</p>
<p><em>[begin quote]“There was no doubt that Ampere took his electrodynamic molecule [that is, the hypothesis of currents of electricity around each molecule] seriously and expected others to do so too. In an answer to a letter from the Dutch physicist van Beck, published in the Journal de Physique in 1821, Ampere argued eloquently for his model, insisting that it could be used to explain not only magnetism but also chemical combination and elective affinity [sic]. In short, it was to be considered the foundation of a new theory of matter. This was one of the reasons why Ampere’s theory of electrodynamics was not immediately and universally accepted. To accept it meant to accept as well a theory of the ultimate structure of matter itself.” [end quote]</em> <span class="citation" data-cites="ampere">(<a href="#ref-ampere" role="doc-biblioref">Assis and Chaib 2015</a>, footnotes pp.24)</span></p>
<p>We have no qualms about Ampere’s electrodynamic molecules and their applications to “ultimate theories of matter”. In fact we are persuaded by Ampere’s argument for <em>homogeneous</em> electrodynamic theories. Magnetism (in Ampere’s conception) is always to be found in environmental electrical currents (i.e.&nbsp;charged matter in motion). Ampere seeks the source of the earth’s magnetism in electrical currents at both the microscopic level in atomic structures, and global macroscopic currents in and through the earth. We cannot be certain whether Ampere ever looked beyond the earth under his feet to the Sun as a source of geomagnetism.</p>
<p><em>So what about the year 2025 being the year of the <a href="https://www.ncei.noaa.gov/products/world-magnetic-model">world magnetic model</a>?</em></p>
<p>The most difficult aspect of the WMM is that earth’s magnetic field is always changing. We understand magnetic forces as <em>dynamic</em> by definition and susceptible to change. But can we really be confident in our maps being accurate one, two, four years later? Obviously cartographers assume the earth’s land masses are not perceptibly moving. Actually WMM is aware of this variability problem. Hence WMM is revised every five years. We quote from the report <a href="https://www.ncei.noaa.gov/sites/g/files/anmtlf171/files/2023-12/WMM_Annual_Report_2023.pdf">“State of the Geomagnetic Field: December 2023”</a>: [begin quote] <em>“The main geomagnetic field is constantly changing due to convective flow of and waves in the Earth’s liquid outer core. As the system is essentially chaotic on longer timescales, this change cannot be entirely predicted, and so the accuracy of the WMM slowly decreases over time, necessitating that it be regularly updated (typically every five years).”</em> [end quote]</p>
<p>Here we notice the reference to fluid analogies, like the convective flow of waves in earth’s supposed “liquid outer core”. What is the convective flow? Wikipedia would suggest that convection arises from some lower heat layer, and then radiates upwards towards the surface. It’s strange really. Also observe the expression <em>“essentially chaotic on longer timescales.”</em> This is another assumption of the fluid model assumptions. Observe also the reference to the necessity(!) of regular updates which are <em>typically</em> every five years. We do not necessarily share in these standard fluid assumptions. Again referring to Ampere, we insist on homogeneous descriptions, as far as possible. So we do not commit to arbitrary fluid hypotheses at this stage.</p>
<p>It is typically presumed that an object is magnetic depending on it’s internal atomic structure. But what is the role of the environment in magnetic effects? For example if a rock on the moon has certain magnetic orientation, and this rock is transported to the earth, will the rock again be magnetic?, and how can we relate the magnetic forces between the two points? Is it possible for a rock to be magnetic when it leaves the moon, and arrives to earth non magnetic, or vice versa? Could it be possible that we take a rock from earth, bring it to the moon, and then return to the earth in the same location, and observe that the magnetic orientation of the rock has changed?</p>
<p>These are questions, but we must insist that there is an environmental contribution, depending on an object’s interaction with its environment. This is inherent to Ampere’s electrodynamic explanation of magnetism: the interacting current is external, or internal to the object, but it’s part of the environment. By contrast, the magnetic field <span class="math inline">\(B\)</span> as defined by the Maxwellian classical approach is supposed to be a local object: at the point <span class="math inline">\(x\)</span> one wants to obtain <span class="math inline">\(B=B(x)\)</span> directly. But is this possible? These are admittedly fundamental questions, hence we repeat them.</p>
</section>
<section id="c.f.-gauss-and-erdmagnetismus" class="level2">
<h2 class="anchored" data-anchor-id="c.f.-gauss-and-erdmagnetismus">C.F. Gauss and Erdmagnetismus</h2>
<p>[<em>Missing references. Will be corrected in future post. -JHM</em>]</p>
<p>The World Magnet Model is still based principally on Carl Friedrich Gauss’ (1777–1855) fundamental research in the earth’s magnetic field and his memoirs on the subject, e.g.&nbsp;<a href="https://en.wikisource.org/wiki/Scientific_Memoirs/2/General_Theory_of_Terrestrial_Magnetism">Gauss’ memoir “General Theory of Terrestrial Magnetism”</a>. Gauss is credited with “demonstrating” that the dominant geomagnetic field is generated from the earth’s interior. This is treated in the above memoir. Gauss’ argument claims to be independant of hypotheses as to the origin and cause of earth’s magnetism. We are amazed how Gauss openly discusses Ampere’s molecular current hypothesis, although Gauss himself adopts Poisson’s magnetic fluid approach. It’s surprising to discover that Gauss was so perceptive of Ampere’s brilliance, and ready to admit them insofar as consistent with experiment.</p>
<p>Gauss’ argument is deduced from his assuming a Coulomb-Poisson type force law between the supposed magnet <span class="math inline">\(NS\)</span> dipoles. Gauss assumes that the magnetic potential is integrated by a Coulomb type expression <span class="math inline">\(V=\int d\mu/r\)</span> where <span class="math inline">\(\mu\)</span> is assumed to be the distribution of “free magnetism”. This is a naive concept by today’s standards. Thus Gauss defines the magnetic force as the gradient of a harmonic potential.</p>
<p>Here we remark that Gauss is correct in reasoning that Coloumb’s formula is consistent with AMCH. Thus Gauss seems to be aware of Ampere’s 1824 results which demonstrated the equivalence of Poisson’s 1823 magnetic force law. But here we think there is a deficiency in both Poisson’s and Ampere’s treatment of the dipole force. Regarding Poisson, we think the molecular magnetic fluid cannot reasonably sustain a dipole surface without an external force. Likewise we criticize Ampere’s electrodynamic solenoid <span class="citation" data-cites="ampere">(<a href="#ref-ampere" role="doc-biblioref">Assis and Chaib 2015, ch.9–10</a>)</span> as insufficient, since there is by necessity an external force necessary to balance the repulsive force of the parallel closed currents. In both cases we claim they do not satisfactorily address the need for external power supply. Our own interpretation is that Ampere was motivated to demonstrate the equivalence of his force law between currents and the molecular current hypothesis with Poisson’s 1823 results. In otherwords, Ampere’s 1824 papers [Ibid] were reactionary, in a sense, and not conclusive.</p>
<p><em>Remark</em>. Gauss considers the “magnetic fluid” as consisting of north and south molecules. But it’s known that there are no material carriers of magnetism, and there are no isolated magnetic poles. Therefore the fundamental premise of the Coulomb-Poisson force seems flawed. Moreover Gauss applies an electrostatic principle of Poisson to represent the distribution of “free magnetic fluid” as supported on the boundary surface of the sphere. This leads to Gauss’ spherical harmonic model of the earth’s magnetic field, and his assumption that the magnetic potential <span class="math inline">\(B=\nabla \phi\)</span> is the gradient of a harmonic potential (!)on the surface of the earth and exterior according to Coulomb-Poisson’s proposed magnetic force law.</p>
<p>Thus Gauss presumes that the source of geomagnetism, i.e.&nbsp;the source of the north and south poles, lies in the interior of the earth. We do not necessarily agree with the esteemed Gauss’ analysis. Yet this analysis remains the dominant model today, the coefficients of the potential are fit according to Gauss’ method of least squares.</p>
<p>However Gauss himself reasons beyond his own model, reasoning in Article 36 of his memoir: [begin quote] <em>“Another part of our theory on which there may exist a doubt is, the supposition that the agents of the terrestrial magnetic force are situated exclusively in the interior of the earth. If we seek for their immediate causes, partly or wholly, without the earth, and confine ourselves to known scientific grounds, we can only think of galvanic currents. But the atmosphere is no conductor of such currents, neither is vacant space; thus, in seeking in the upper regions for a vehicle of galvanic currents we go beyond our knowledge. ·But our ignorance gives us no right absolutely to deny the possibility of such currents; we are forbidden to do so by the enigmatical phenomena of the Aurora Borealis, in which there is every appearance that electricity in motion performs a principal part. It will therefore still be interesting to examine what form magnetic action arising from such currents would assume on the surface of the earth.”</em> [end quote].</p>
<p>Thus we are led to further consider the electrodynamic cylinders and the dipole surfaces, and our earlier critique that <em>both</em> models require an external force to maintain the assumed separations. There is an idea here that the earth’s magnetic fields are secondary electric effects caused by the primary Birkeland polar circuits. This is the external force necessary to maintain the charge separations in Ampere’s dynamic solenoid, and likewise would be the force providing the energy required for the dipole magnetic separation assumed in Poisson’s explanation.</p>
<p>For us, the key is that Ampere’s idea of perfectly parallel electrical currents defining the cylinder are not physically realistic. Parallel currents repel. Therefore any parallel currents, as we understand them, would require an external power source to maintain the separation. Apparently this idea is rather common in plasma physics, where it’s understood that double layers only exist in nontrivial currents.</p>
<p>So the conclusion? That we need to look to the aurora and correct the error common to both Ampere and Poisson in the electrodynamic cylinder and the magnetic dipole layers, respectively.</p>
<p>[To be continued –JHM]</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-ampere" class="csl-entry" role="listitem">
Assis, Andre Koch Torres, and JPMC Chaib. 2015. <span>“Amp<span>è</span>re’s Electrodynamics.”</span> <em>Available Under: Http://Www. Ifi. Unicamp. Br/~ Assis/Amperes-Electrodynamics. Pdf</em>, 72–80.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>