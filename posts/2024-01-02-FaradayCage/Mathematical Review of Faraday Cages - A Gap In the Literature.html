<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="JHM">
<meta name="dcterms.date" content="2024-01-02">
<meta name="description" content="Preliminary article. We review the basic properties of Faraday cages and a curious absence of any mathematical proof of their supposed properties from the Maxwell field equations. This leads to some basic questions.">

<title>jhm - Mathematical Review of Faraday Cages. A Gap In the Literature.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">jhm</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jhmartel/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/_jhmlabs" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Mathematical Review of Faraday Cages. A Gap In the Literature.</h1>
                  <div>
        <div class="description">
          Preliminary article. We review the basic properties of Faraday cages and a curious absence of any mathematical proof of their supposed properties from the Maxwell field equations. This leads to some basic questions.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Faraday</div>
                <div class="quarto-category">harmonic functions</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>JHM </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 2, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><em>In this article we review the basic properties of Faraday cages.</em></p>
<p>We were brought to this subject reviewing Professor A.K.T. Assis’ book with J.A. Hernandes <a href="https://www.ifi.unicamp.br/~assis/The-Electric-Force-of-a-Current.pdf">“The Electric Force of a Current”</a>. Assis remarks that Faraday cages have surprising properties which are elementary, but not well known. Moreover the authors of [ “Mathematics of the Faraday cage.” Siam Review 57.3 (2015): 398-417] were surprised to find no readily available references or mathematical explanations of Faraday’s cage. This was the beginning of our investigation.</p>
<section id="hollow-conductors" class="level1">
<h1><em>Hollow Conductors</em></h1>
<p>In this article <span class="math inline">\(C\)</span> denotes a conductive body in <span class="math inline">\(R^3\)</span>. This means <span class="math inline">\(C\)</span> has a boundary surface <span class="math inline">\(S = \partial C\)</span>, and has a complement <span class="math inline">\(R^3 - C\)</span>. We say <span class="math inline">\(C\)</span> is <em>hollow</em> if <span class="math inline">\(C\)</span> divides <span class="math inline">\(R^3\)</span> into “inside” and “outside” volumes, i.e.&nbsp;if <span class="math inline">\(R^3-C\)</span> consists of <em>two</em> connected components. In our examples <span class="math inline">\(C\)</span> will be a hollow spherical shell. The width of the shell is thin. By contrast we might otherwise have a solid spherical ball, and in this case the conductor is solid.</p>
<p>To say the body <span class="math inline">\(C\)</span> is a <em>conductor</em> means the shell consists of metal or aluminum, something with abundance of free mobile electrons. By contrast an <em>insulator</em> is made of glass, or ceramic porcelain, or rubber, or oil and plastics.</p>
<p>In the setting of Faraday cages, we have a <em>hollow</em> conducting body <span class="math inline">\(C\)</span>. Topologically this means <span class="math inline">\(C\)</span> divides the ambient space <span class="math inline">\({\bf{R}}^3\)</span> into two volumes <span class="math inline">\({\bf{R}}^3 - C = V_i \coprod V_o\)</span>. We consider <span class="math inline">\(V_i, V_o\)</span> as the <em>inner</em> and <em>outer</em> volumes bounded by <span class="math inline">\(C\)</span>. The coproduct symbol “<span class="math inline">\(\coprod\)</span>” emphasizes that the volumes <span class="math inline">\(V_i\)</span>, <span class="math inline">\(V_o\)</span> are <em>disjoint</em>. For a hollow conductor <span class="math inline">\(C\)</span>, the boundary intersections <span class="math inline">\(\partial V_i\)</span> and <span class="math inline">\(\partial V_o\)</span> are disjoint and also partition the topological boundary <span class="math inline">\(S=\partial C\)</span> of the conductor. For example a hollow sphere has <em>two</em> boundary components, namely the inner and outer surfaces, which are disjoint and bound the inner and outer volumes.</p>
<p>With Faraday cages we consider a hollow conductor <span class="math inline">\(C\)</span> and study the presence or absence of electrical forces in the interior volume. The basic question motivating Faraday cages is this:</p>
<ul>
<li>“If <span class="math inline">\(C\)</span> is a hollow conductor and <span class="math inline">\(F_{ext}\)</span> is an external electric force originating from the exterior volume, then what is the net electric force on the interior volume <span class="math inline">\(V_i\)</span>?”</li>
</ul>
<p>Actually we will see many Faraday cages are bird cages, being not hollow and having no well-defined topological interior or exterior, i.e.&nbsp;the bird cage does not divide <span class="math inline">\(R^3\)</span> into two volumes! In these cases the Faraday shielding effect is informally(!) phrased as:</p>
<ul>
<li>“If <span class="math inline">\(C\)</span> is a bird cage conductor (not hollow) and <span class="math inline">\(F_{ext}\)</span> is an electric force originating from an external source, then what is the net electric force <em>inside</em> the bird cage?”</li>
</ul>
<p>We should remark that bird cages have no interor or exterior, unless you’re a bird who can’t fit through the grates. From the bird’s point of view, the cage divides space into two volumes which are disjoint and inaccesible.</p>
<p><img src="img/birdcage.jpg" class="img-fluid"></p>
<p>Therefore we do not deny the apparent shielding effects. But we think there is yet no satisfactory derivation. Historically there are two opposing viewpoints. First we have the standard Faraday-Maxwell viewpoint that conductors have a “shielding effect” and the electric field vanishes within the interior of <span class="math inline">\(V_i\)</span> in the above setting. Second we have the nonstandard viewpoint of Weber-Kirchoff that the electric field is <em>nonzero</em> on the interior of <span class="math inline">\(V_i\)</span>. Both claims cannot be correct.</p>
</section>
<section id="poissons-theorem-and-surface-charge-distributions" class="level1">
<h1><em>Poisson’s Theorem and Surface Charge Distributions</em>:</h1>
<p>We begin with Poisson’s fundamental theorem on electrostatics (1812).</p>
<ul>
<li><em>“When arbitrary electric forces act upon a conductor of arbitrary form from the outside, a distribution of free electricity on the surface of the conductor is always possible – but only one of them – for which the electric forces that originate from that distribution of free electricity will likewise be in equilibrium with the electric forces at all points of the interior of the conductor that act from the outside.”</em> [Quoted from Weber, s 13.29].</li>
</ul>
<p>Notice the topological expressions e.g.&nbsp;“<em>from the outside</em>”, “<em>on the surface</em>”, “<em>of the interior</em>”. In practice the “inside of <span class="math inline">\(C\)</span>” and the “interior volume bounded by <span class="math inline">\(C\)</span>” are frequently confused, especially in the case when the conductor <span class="math inline">\(C\)</span> is a thin volume, e.g.&nbsp;thin hollow spherical shell <span class="math inline">\("O"\)</span>.</p>
<p>Here’s the formal statement of Poisson’s theorem:</p>
<ul>
<li>“Given a conducting body <span class="math inline">\(C\)</span>, and a net external force <span class="math inline">\(F_{ext}\)</span> acting on <span class="math inline">\(C\)</span>, then there exists a <em>unique surface charge distribution</em> <span class="math inline">\(\sigma\)</span> on the <em>boundary surface</em> <span class="math inline">\(\partial C\)</span> such that <span class="math display">\[F_{ext}(x)+F_\sigma(x) =0~~\text{for every}~~x\in C."\]</span></li>
</ul>
<p>The key point is that the force throughout the volume of the body is balanced by a charge distribution supported only on the boundary surface <span class="math inline">\(S=\partial C\)</span>.</p>
<p>[Comment about surface charge distributions and normal derivative] The surface charge <span class="math inline">\(\sigma\)</span> is obtained via the normal derivative of the potential <span class="math inline">\(\phi\)</span> along the boundary, namely <span class="math inline">\(\frac{\partial \phi}{\partial n}\)</span>, which is by definition equal to <span class="math inline">\(\nabla \phi \cdot {\bf{n}}~ dS\)</span> where <span class="math inline">\(\bf{n}\)</span> is the “outer” normal of the surface.</p>
<p>Poisson claims the net force <span class="math inline">\(F_{net}(x)=0\)</span> vanishes for <span class="math inline">\(x\in C\)</span> everywhere inside the conductor. However the Faraday-Maxwell shielding effect asserts that <span class="math inline">\(F_{net}(x)=0\)</span> everywhere in the inner volume <span class="math inline">\(x\in V_i\)</span>. We argue with Weber. et al, that indeed <span class="math inline">\(F_{net}\)</span> is <em>nonzero</em> in <span class="math inline">\(V_i\)</span>!</p>
<p><em>Proof of Poisson’s Theorem:</em> [Incomplete] [Green-Thompson Energy Argument?]</p>
</section>
<section id="method-of-images" class="level1">
<h1><em>Method of Images </em></h1>
<p>What are we saying, that Faraday cages don’t work? That you shouldn’t put your face next to the microwave? No, well maybe.</p>
<p>[Method of images: Review!] Here is the basic example: suppose the conductor <span class="math inline">\(C\)</span> is the lower halfspace <span class="math inline">\(\{(x,y)~|~y\leq 0\}\)</span>. Suppose an electric point charge <span class="math inline">\(+q\)</span> is placed external to <span class="math inline">\(C\)</span>, i.e.&nbsp;somewhere on the vertical half line <span class="math inline">\(y&gt;0\)</span>. Then Poisson’s theorem says there exists a surface distibution on <span class="math inline">\(C\)</span> which balances the net force of the charge <span class="math inline">\(+q\)</span>. Here we argue by the method of images. The test charge <span class="math inline">\(+q\)</span> induces a charge in the conductor equivalent to the field generated by an image charge <span class="math inline">\(-q_i\)</span>. The net electric potential is therefore the sum of the potentials generated by these point sources <span class="math inline">\(+q\)</span> and <span class="math inline">\(-q_i\)</span>, and the electric field is the sum of the electric fields generated by the sources <span class="math inline">\(+q, -q_i\)</span>. In this example we see the boundary surface <span class="math inline">\(\partial C\)</span> is an equipotential surface.</p>
<p>Remark. The argument is usually erroneously made via Gauss’ law. The error is supposing that a vanishing charge density implies a vanishing electric field. This is false! Gauss’ law relates the <em>divergence</em> of the electric field to the charge density <span class="math inline">\(\rho\)</span>. But vanishing divergence <span class="math inline">\(div(\nabla \phi)\)</span>=0$ of course does <em>not</em> imply a vanishing gradient <span class="math inline">\(\nabla \phi\)</span>. [See links below].</p>
</section>
<section id="but-what-about-experiments" class="level1">
<h1><em>“But What About Experiments?”</em></h1>
<p>But what about all the experiments? A google search gives twenty links on how to make your own Faraday cage in five minutes for five dollars. We argue that there is an <em>apparent shielding effect</em>, yet this shielding effect is unexplained hitherto.</p>
<p>For example it’s <a href="https://www.juliantrubin.com/bigten/faradaycageexperiments.html">recorded</a> that Faraday built a room in 1836 coated with metal foil (specific metal unknown) and could not detect any electrical forces <em>inside</em> the room neither near it’s walls. But <em>what is the explanation</em>?</p>
<p>It’s interesting that many applications of Faraday cages involve <em>bird cage</em> designs, where the conductor <span class="math inline">\(C\)</span> actually does not topologically divide the space into inner and outer volumes. In applications the following heuristic is introduced: that the cage only shields radiation which is too large to impinge and pass through the “grates”. This does not really follow from the usual arguments and involves <em>new implicit hypotheses</em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="faraday1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><a href="https://youtu.be/mxwVIOHEG4I">Screenshot from “Prelude to Power”</a></figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="faraday2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">ibid</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="faraday3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">ibid</figcaption>
</figure>
</div>
<ul>
<li><p><a href="https://youtu.be/KVDCf9sz3fw">Katie Loves Physics on history of Faraday Cage.</a></p></li>
<li><p><a href="https://www.physicsforums.com/threads/mathematical-derivation-of-the-faraday-cage-from-the-maxwell-equations.119927/">“How to derive Faraday cage properties from Maxwell equations?”</a>.</p></li>
<li><p><a href="https://physics.stackexchange.com/questions/537560/why-is-the-charge-distribution-on-the-outer-surface-of-a-hollow-conducting-spher">“Why is charge distribution on outer surface zero?”</a></p></li>
<li><p><a href="https://physics.stackexchange.com/questions/694637/how-is-the-electric-field-inside-a-hollow-conducting-sphere-zero">“How is electric field inside hollow conducting sphere zero?”</a></p></li>
<li><p><a href="https://physics.stackexchange.com/questions/729232/field-inside-hollow-conducting-sphere?rq=1">“What is electric field inside hollow conducting sphere?’</a></p></li>
<li><p><a href="https://physics.stackexchange.com/questions/617489/electric-field-inside-a-cavity-faraday-cage">“What is electric field inside Faraday cage?”</a></p></li>
<li><p><a href="https://physics.stackexchange.com/questions/192266/electric-field-inside-hollow-conducting-bodies">“What is electric field inside hollow conducting body?”</a></p></li>
<li><p><a href="https://www.youtube.com/watch?v=GYLn7wgGxPo">EMP Misconceptions</a>.</p></li>
</ul>
<p>There’s alot of different answers, but always ending with a nonexplanation, simply the claim that the resultant electric fields cancel to zero. Similarly there is repeated erroneous argument based on Gauss’ law. But again we must emphasize that the vanishing charge density does not imply a vanishing electric field! This is elementary mistake repeated again and again.</p>
</section>
<section id="prof.-lewins-experiment" class="level1">
<h1><em>Prof.&nbsp;Lewin’s Experiment</em></h1>
<p>Prof.&nbsp;Lewin’s <a href="https://youtu.be/t23iXhEiQUc">experiment</a> does not seem convincing. He has a conductive ping pong. Are we expected to believe that if his pingpong touches the positively charged surface, then this positive charge will be imparted to the pingpong rod, and eventually ? This is only if the positive charges are mobile and attracted to the rod.</p>
<p>He touches one side of the box and it’s negatively charged. He touches the other side of the box, and he sees that it’s positively charged. (He’s collecting these charges using the condutive ping pong, then discharging at an electrometer to see the polarity, positive or negative charge). But then Prof.&nbsp;Lewin places the pingpong in the volume bounded by the conductor can, and he moves the ping pong around and seems to indicate that he collects no free electric charges. The absence of charges is shown by the electrometer registering no charge. But what does this show? Not that there is zero net force in the interior, but rather that there are no free electrons!</p>
<p>Is this fair critique? There are no mobile positive ions which are collected by the pingpong and then deposited. Rather there’s only mobile electrons. On the negative side, there is an excess of electrons which are possibly attracted to the pingpong. On the positive side there is an absence of electrons. When the pingpong conductor is placed in physical contact with the box, there is a flow of electrons from the pingpong conductor to the box.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>